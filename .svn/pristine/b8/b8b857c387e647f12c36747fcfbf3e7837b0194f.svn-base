using MultiPlayer.Server;
using MultiPlayer.Server.Module;
using MultiPlayer.Server.VMS;
using MultiPlayer.UILements;
using System.Net;
using System.Windows;

namespace MultiPlayer
{
    /// <summary>
    /// Interaction logic for MainWindow.xaml
    /// </summary>
    public partial class MainWindow : Window
    {
        private bool _showLogs;
        private RootManager _root;

        public MainWindow()
        {
            InitializeComponent();
            Logger.Instance.LogMain("Starting up...");

            _root = new RootManager();
            _root.Initialize();

            rootGrid.DataContext = _root;

            _showLogs = false;
            modulesDropbox.SelectedIndex = 0;

            Logger.Instance.LogMain("Initialized");
        }

        private void PlayClicked(object sender, RoutedEventArgs e)
        {
            var item = (sender as ImageButton)?.DataContext as ServerInstanceVM;
            if (item != null)
            {
                var inst = _root.GetModule(item);
                Logger.Instance.LogMain($"Running module [{inst.ModuleName}]");
                inst.Start();
            }
        }

        private void StopClicked(object sender, RoutedEventArgs e)
        {
            var item = (sender as ImageButton)?.DataContext as ServerInstanceVM;
            if (item != null)
            {
                var inst = _root.GetModule(item);
                inst.Stop();
            }
        }

        private void PauseClicked(object sender, RoutedEventArgs e)
        {
            throw new NotImplementedException();
        }

        private void RemoveClicked(object sender, RoutedEventArgs e)
        {
            var item = (sender as ImageButton)?.DataContext as ServerInstanceVM;
            if (item != null)
                _root.RemoveModule(item);
        }

        private void AddInstanceClicked(object sender, RoutedEventArgs e)
        {
            _root.CreateServerInstance(modulesDropbox.SelectedIndex, newName.Text, newPort.Text);
        }

        private void LogVisibilitToggleClick(object sender, RoutedEventArgs e)
        {
            _showLogs = !_showLogs;
            logsColumn.Width = new GridLength(_showLogs ? 20.0 : 0.0, GridUnitType.Star);
        }
    }

}